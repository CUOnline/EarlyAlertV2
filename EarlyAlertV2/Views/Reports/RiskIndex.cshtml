@using EarlyAlertV2.ViewModels.ReportViewModels
@model RiskIndexReportViewModel

<style>
    .reload {
        margin-top: .35em;
        font-weight: 300;
        line-height: 1em;
        font-size: 1.7em;
    }

    .reload-icon {
        position: relative;
    }

    .userRow {
        cursor: pointer;
    }

</style>

<div id="app">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header" data-background-color="blue">
                    <div class="row">
                        <div class="col-md-6 col-sm-6 col-xs-6">
                            <div class="card-block">
                                <h4 class="title">Students</h4>
                                <p class="category">Select a student to see his/her student profile.</p>
                            </div>
                        </div>
                        @if (User.IsInRole(UserRoles.AdminRole) || User.IsInRole(UserRoles.OITAdminRole))
                        {
                            <div v-if="loading" class="col-md-6 col-sm-6 col-xs-6 text-right">
                                <div class="btn btn-primary" v-on:click="viewProgress">
                                    <p class="reload">View Progress</p>
                                </div>
                            </div>
                            <div v-else class="col-md-6 col-sm-6 col-xs-6 text-right">
                                <div class="btn btn-primary" v-on:click="refreshData">
                                    <p class="reload">Reload Data</p>
                                </div>
                            </div>
                        }
                    </div>
                </div>
                <div class="card-content table-responsive">
                    <table class="table table-hover">
                        <thead class="text-primary">
                            <tr>
                                <th></th>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Risk Index</th>
                            </tr>
                        </thead>
                        <tbody v-for="user in orderedUsers">
                            <tr v-bind:class="[ user.hasError ? 'danger' : '' ]" v-bind:data-toggle="{ tooltip: user.hasError }" v-bind:data-placement="{ bottom: user.hasError }" v-bind:title="[ user.error ]">
                                <td v-if="user.error" v-on:click="refreshUserData(user.id)" style="cursor: pointer">
                                    <i class="material-icons reload-icon">refresh</i>
                                </td>
                                <td v-else></td>
                                <td>{{user.id}}</td>
                                <td v-on:click="viewStudentProfile(user.id)" style="cursor: pointer">{{user.name}}</td>
                                <td v-if="user.riskIndex >= 75">
                                    <div class="progress-bar progress-bar-danger" role="progressbar" v-bind:style="'width: ' + user.riskIndex + '%'">
                                        {{user.riskIndex | formatRiskIndex}}%
                                    </div>
                                    {{user.riskIndex}}
                                </td>
                                <td v-else-if="user.riskIndex >= 50">
                                    <div class="progress-bar" role="progressbar" v-bind:style="'background-color: #f59a2a; width: '+ user.riskIndex + '%'">
                                        {{user.riskIndex | formatRiskIndex}}%
                                    </div>
                                </td>
                                <td v-else-if="user.riskIndex >= 25">
                                    <div class="progress-bar" role="progressbar" v-bind:style="'background-color: #baca38; width: '+ user.riskIndex + '%'">
                                        {{user.riskIndex | formatRiskIndex}}%
                                    </div>
                                </td>
                                <td v-else>
                                    <div class="progress-bar progress-bar-success" role="progressbar" v-bind:style="'width: ' + user.riskIndex + '%'">
                                        {{user.riskIndex | formatRiskIndex}}%
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="pleaseWaitDialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Processing...</h3>
                </div>
                <div class="modal-body">
                    <div class="progress">
                        <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" v-bind:aria-valuenow="refreshProgress" aria-valuemin="0" aria-valuemax="100" v-bind:style="'width: ' + refreshProgress + '%'">
                            <span class="sr-only">{{refreshProgress}}% Complete (success)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="~/js/RiskIndex.js"></script>